# MQStudy

## MQ的基本概念
### MQ概述
MQ全程 Message Queue 消息队列，是在消息的传输过程中保存消息的容器，多用于分布式系统之间进行通信

假设A B是分布式系统中的两个服务

* 一般情况下A B之间发生一些交互，会采用A 远程调用B的方式来实现
* 我们也可以采用一些异步的方式，A发送数据给某个中间商，B再从中间商获取数据，MQ就是这样的中间商
    * 我们一般称A（发送方）为生产者，B（接收方）为消费者
    
### MQ的优势和劣势
优势
* 应用解耦
* 异步提速
* 削峰填谷

劣势
* 系统可用性降低
* 系统复杂度提高
* 一致性问题

#### 应用解耦
在分布式系统中适当降低应用之间的耦合。

比如一个商品下单系统，如果订单--支付--物流，所有的服务耦合在一起，同步调用，就会导致系统的可用性降低。
但是从业务分析，物流系统的暂时不可用，不会影响下单和支付，所以可以将物流系统解耦出来，将整体服务的容错性提高

再比如另外一种场景，当完成一单支付后，需要生成物流信息，账单发送，库存扣减，优惠券扣减等。如果采用同步调用的方式，系统的响应时间会不断增长，此时也可以采用MQ消息，将所有的链路解耦

#### 异步提速
缩短同步调用带来的耗时增加，类似java中的异步调用一样，可以带来响应时间的缩短。

#### 削峰填谷
类似于公司内现有的渲染场景，白天业务量大，渲染数量多，如果需要立即渲染，可以需要非常大的服务器数量，夜间又由于业务量缩减，所有机器都处于空闲，浪费资源。
可以采用白天需要渲染的任务存于MQ中，低峰期进行渲染的策略，平衡渲染与业务量之间的关系。

#### 系统的可用性降低
引入了MQ之后，除了要保证原有的业务系统服务可用之外，还要额外保证MQ的稳定性和可用性

#### 系统复杂度提高
MQ的加入大大增加了系统的复杂度，以前系统间是同步的远程调用，现在则是异步调用。如何保证消息未被重复消费，如何保证消费顺序，如何处理信息丢失，都是需要考虑的问题。

#### 一致性问题
A系统处理完成业务后，通过MQ给B C D系统发消息，如果B C处理成功D系统处理失败，怎么办？如何保证消息处理的一致性？

### 小结
使用MQ需要满足的条件是：
* 生产者不需要从消费者处获得反馈
* 允许短暂的不一致性
* 使用MQ后引入的管理成本，低于解耦，提速，削峰带来的收益

## 常见的MQ对比

![mq对比](https://github.com/liuguanglei123/MQStudy/blob/main/images/mq1.png "mq对比")

# RabbitMQ简介
AMQP Advanced Message Queuing Protocol(高级消息队列协议)，是一个网络协议，是应用层协议的一个开放标准。
为面向对象的中间件设计。基于此协议的客户端与消息中间件可传递消息，并不受客户端/中间件不同产品，不同的开发语言等条件的限制。类比HTTP

![AMQP](https://github.com/liuguanglei123/MQStudy/blob/main/images/mq2.png "AMQP")



























